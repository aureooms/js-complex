'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});

exports.default = function (parse, $0, $1, $_1, symbol) {

	return function (s, i, j) {

		var aj = void 0,
		    bi = void 0,
		    dflt = void 0;

		if (i === j) {
			return [$0(), $0()];
		}

		var ai = i;

		var c = s[i];

		for (;;) {

			if (c === symbol) {
				if (ai === i) {
					return [$0(), $1()];
				} else if (ai === i - 1) {
					if (s[ai] === '-') {
						return [$0(), $_1()];
					} else if (s[ai] === '+') {
						return [$0(), $1()];
					} else {
						return [$0(), parse(s.slice(ai, i))];
					}
				} else {
					return [$0(), parse(s.slice(ai, i))];
				}
			}

			++i;

			if (i >= j) {
				return [parse(s.slice(ai, j)), $0()];
			}

			c = s[i];

			if (c === '+') {
				dflt = $1;
				aj = i;
				bi = i;
				break;
			} else if (c === '-') {
				dflt = $_1;
				aj = i;
				bi = i;
				break;
			}
		}

		for (;;) {

			++i;
			c = s[i];

			if (c === symbol) {
				if (bi === i - 1) {
					return [parse(s.slice(ai, aj)), dflt()];
				} else {
					return [parse(s.slice(ai, aj)), parse(s.slice(bi, i))];
				}
			}
		}
	};
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jYXJ0ZXNpYW4va2VybmVsL2NvcmUvcGFyc2UuanMiXSwibmFtZXMiOlsicGFyc2UiLCIkMCIsIiQxIiwiJF8xIiwic3ltYm9sIiwicyIsImkiLCJqIiwiYWoiLCJiaSIsImRmbHQiLCJhaSIsImMiLCJzbGljZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O2tCQVFlLFVBQVVBLEtBQVYsRUFBaUJDLEVBQWpCLEVBQXFCQyxFQUFyQixFQUF5QkMsR0FBekIsRUFBOEJDLE1BQTlCLEVBQXNDOztBQUVwRCxRQUFPLFVBQVVDLENBQVYsRUFBYUMsQ0FBYixFQUFnQkMsQ0FBaEIsRUFBbUI7O0FBRXpCLE1BQUlDLFdBQUo7QUFBQSxNQUFTQyxXQUFUO0FBQUEsTUFBY0MsYUFBZDs7QUFFQSxNQUFJSixNQUFNQyxDQUFWLEVBQWE7QUFDWixVQUFPLENBQUNOLElBQUQsRUFBT0EsSUFBUCxDQUFQO0FBQ0E7O0FBRUQsTUFBSVUsS0FBS0wsQ0FBVDs7QUFFQSxNQUFJTSxJQUFJUCxFQUFFQyxDQUFGLENBQVI7O0FBRUEsV0FBUzs7QUFFUixPQUFJTSxNQUFNUixNQUFWLEVBQWtCO0FBQ2pCLFFBQUlPLE9BQU9MLENBQVgsRUFBYztBQUNiLFlBQU8sQ0FBQ0wsSUFBRCxFQUFPQyxJQUFQLENBQVA7QUFDQSxLQUZELE1BR0ssSUFBSVMsT0FBT0wsSUFBSSxDQUFmLEVBQWtCO0FBQ3RCLFNBQUlELEVBQUVNLEVBQUYsTUFBVSxHQUFkLEVBQW1CO0FBQ2xCLGFBQU8sQ0FBQ1YsSUFBRCxFQUFPRSxLQUFQLENBQVA7QUFDQSxNQUZELE1BR0ssSUFBSUUsRUFBRU0sRUFBRixNQUFVLEdBQWQsRUFBbUI7QUFDdkIsYUFBTyxDQUFDVixJQUFELEVBQU9DLElBQVAsQ0FBUDtBQUNBLE1BRkksTUFHQTtBQUNKLGFBQU8sQ0FBQ0QsSUFBRCxFQUFPRCxNQUFNSyxFQUFFUSxLQUFGLENBQVNGLEVBQVQsRUFBY0wsQ0FBZCxDQUFOLENBQVAsQ0FBUDtBQUNBO0FBQ0QsS0FWSSxNQVdBO0FBQ0osWUFBTyxDQUFDTCxJQUFELEVBQU9ELE1BQU1LLEVBQUVRLEtBQUYsQ0FBU0YsRUFBVCxFQUFjTCxDQUFkLENBQU4sQ0FBUCxDQUFQO0FBQ0E7QUFDRDs7QUFFRCxLQUFFQSxDQUFGOztBQUVBLE9BQUlBLEtBQUtDLENBQVQsRUFBWTtBQUNYLFdBQU8sQ0FBQ1AsTUFBTUssRUFBRVEsS0FBRixDQUFTRixFQUFULEVBQWNKLENBQWQsQ0FBTixDQUFELEVBQTBCTixJQUExQixDQUFQO0FBQ0E7O0FBRURXLE9BQUlQLEVBQUVDLENBQUYsQ0FBSjs7QUFFQSxPQUFLTSxNQUFNLEdBQVgsRUFBaUI7QUFDaEJGLFdBQU9SLEVBQVA7QUFDQU0sU0FBS0YsQ0FBTDtBQUNBRyxTQUFLSCxDQUFMO0FBQ0E7QUFDQSxJQUxELE1BTUssSUFBS00sTUFBTSxHQUFYLEVBQWlCO0FBQ3JCRixXQUFPUCxHQUFQO0FBQ0FLLFNBQUtGLENBQUw7QUFDQUcsU0FBS0gsQ0FBTDtBQUNBO0FBQ0E7QUFFRDs7QUFHRCxXQUFTOztBQUVSLEtBQUVBLENBQUY7QUFDQU0sT0FBSVAsRUFBRUMsQ0FBRixDQUFKOztBQUVBLE9BQUlNLE1BQU1SLE1BQVYsRUFBa0I7QUFDakIsUUFBSUssT0FBT0gsSUFBSSxDQUFmLEVBQWtCO0FBQ2pCLFlBQU8sQ0FBQ04sTUFBTUssRUFBRVEsS0FBRixDQUFTRixFQUFULEVBQWNILEVBQWQsQ0FBTixDQUFELEVBQTJCRSxNQUEzQixDQUFQO0FBQ0EsS0FGRCxNQUdLO0FBQ0osWUFBTyxDQUFDVixNQUFNSyxFQUFFUSxLQUFGLENBQVNGLEVBQVQsRUFBY0gsRUFBZCxDQUFOLENBQUQsRUFBMkJSLE1BQU1LLEVBQUVRLEtBQUYsQ0FBU0osRUFBVCxFQUFjSCxDQUFkLENBQU4sQ0FBM0IsQ0FBUDtBQUNBO0FBQ0Q7QUFFRDtBQUVELEVBMUVEO0FBMkVBLEMiLCJmaWxlIjoicGFyc2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcbi8qKlxuICogUGFyc2VcbiAqXG4gKiAvIVxcIERPRVMgTk9UIENVUlJFTlRMWSBLTk9XIFdIQVRcbiAqICAgICBXT1VMRCBCRSBUSEUgQkVTVCBJTVBMRU1FTlRBVElPTlxuICovXG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIChwYXJzZSwgJDAsICQxLCAkXzEsIHN5bWJvbCkge1xuXG5cdHJldHVybiBmdW5jdGlvbiAocywgaSwgaikge1xuXG5cdFx0bGV0IGFqICwgYmkgLCBkZmx0IDtcblxuXHRcdGlmIChpID09PSBqKSB7XG5cdFx0XHRyZXR1cm4gWyQwKCksICQwKCldO1xuXHRcdH1cblxuXHRcdGxldCBhaSA9IGk7XG5cblx0XHRsZXQgYyA9IHNbaV07XG5cblx0XHRmb3IgKDs7KSB7XG5cblx0XHRcdGlmIChjID09PSBzeW1ib2wpIHtcblx0XHRcdFx0aWYgKGFpID09PSBpKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFskMCgpLCAkMSgpXTtcblx0XHRcdFx0fVxuXHRcdFx0XHRlbHNlIGlmIChhaSA9PT0gaSAtIDEpIHtcblx0XHRcdFx0XHRpZiAoc1thaV0gPT09ICctJykge1xuXHRcdFx0XHRcdFx0cmV0dXJuIFskMCgpLCAkXzEoKV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGVsc2UgaWYgKHNbYWldID09PSAnKycpIHtcblx0XHRcdFx0XHRcdHJldHVybiBbJDAoKSwgJDEoKV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdFx0cmV0dXJuIFskMCgpLCBwYXJzZShzLnNsaWNlKCBhaSAsIGkpKV07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2Uge1xuXHRcdFx0XHRcdHJldHVybiBbJDAoKSwgcGFyc2Uocy5zbGljZSggYWkgLCBpKSldO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdCsraTtcblxuXHRcdFx0aWYgKGkgPj0gaikge1xuXHRcdFx0XHRyZXR1cm4gW3BhcnNlKHMuc2xpY2UoIGFpICwgaikpLCAkMCgpXTtcblx0XHRcdH1cblxuXHRcdFx0YyA9IHNbaV07XG5cblx0XHRcdGlmICggYyA9PT0gJysnICkge1xuXHRcdFx0XHRkZmx0ID0gJDE7XG5cdFx0XHRcdGFqID0gaTtcblx0XHRcdFx0YmkgPSBpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHRcdGVsc2UgaWYgKCBjID09PSAnLScgKSB7XG5cdFx0XHRcdGRmbHQgPSAkXzE7XG5cdFx0XHRcdGFqID0gaTtcblx0XHRcdFx0YmkgPSBpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdH1cblxuXG5cdFx0Zm9yICg7Oykge1xuXG5cdFx0XHQrK2k7XG5cdFx0XHRjID0gc1tpXTtcblxuXHRcdFx0aWYgKGMgPT09IHN5bWJvbCkge1xuXHRcdFx0XHRpZiAoYmkgPT09IGkgLSAxKSB7XG5cdFx0XHRcdFx0cmV0dXJuIFtwYXJzZShzLnNsaWNlKCBhaSAsIGFqKSksIGRmbHQoKV07XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIFtwYXJzZShzLnNsaWNlKCBhaSAsIGFqKSksIHBhcnNlKHMuc2xpY2UoIGJpICwgaSkpXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0fVxuXG5cdH07XG59XG5cbiJdfQ==